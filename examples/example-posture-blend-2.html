<!DOCTYPE html>

<html>

	<head>
		<script src="../three.min.js"></script>
		<script src="../mannequin.js"></script>
	</head>
	
	<body>
		<script>
		
			createScene();
			
			var man0 = new Male(),
				man1 = new Male(),
				man  = new Male();
				
			// stick
			var geometry = new THREE.CylinderBufferGeometry(0.4,0.4,80),
				material = new THREE.MeshPhongMaterial({color:'crimson'}),
				stick = new THREE.Mesh(geometry,material);
				stick.rotation.x = rad(90);
				stick.position.set(-0.5,1,0);
				stick.castShadow = true;
				
			man.r_fingers.attach(stick);
			man0.r_fingers.attach(stick.clone());
			man1.r_fingers.attach(stick.clone());

			man0.position.x = -30;
			man0.position.y -= 11.2349;
			man1.position.x = +30;
			man1.position.y -= 0.2;
			
			// preset postures
			var A = {"version":3,"data":[[-5,10,-15],[15,-30,20],[0,-70,0],[6,0,30],[25],[0,-6,-42],[40,20,-85],[90],[-20,-20,-35],[-70,30,0],[155],[0,30,0],[-10],[70,0,0],[40],[-20,-60,0],[90]]}
			
			var B = {"version":3,"data":[[0,-90,0],[0,0,0],[0,0,0],[10,0,0],[0],[0,-10,0],[-10,0,0],[0],[0,10,0],[-10,10,-10],[20],[0,0,-20],[20],[30,0,-20],[70],[40,30,0],[90]]};
			
			man0.posture = A;
			man1.posture = B;
			
			man0.traverse( function(o) {
				if(o.material)
				{
					o.material.transparent = true;
					o.material.opacity = 0.3;
					o.material.depthWrite = false;
				}
			} );
			man1.traverse( function(o) {
				if(o.material)
				{
					o.material.transparent = true;
					o.material.opacity = 0.3;
					o.material.depthWrite = false;
				}
			} );


			function animate(t)
			{
				var k = THREE.Math.clamp( 0.5+0.6*sin(t), 0, 1 );

				man.posture = Mannequin.blend(A,B,k);
				man.position.x = THREE.Math.mapLinear(k,0,1,-30,30);

				var bottom = Math.min(
					man.l_ankle.point(-2,2,2).y,
					man.l_ankle.point(-2,2,-2).y,
					man.l_ankle.point(-2.5,-1,0).y,
					man.l_ankle.point(-2.1,6,0).y,
				);
				man.position.y += (-29.5-bottom)

				scene.rotation.y = sin(t/10);
			}
		</script>
	</body>
	
</html>